---
title: "nls - sin"
output: html_notebook
---

```{r}
source("../../R/2_tusk/utils/simulation.R")
```

```{r}
xi <- rxi()
Y <- f(xi) + rnorm(n, 0, omega)
```

```{r}
A.B.max <- max(Y) + omega
A.c <- runif(1, -A.B.max, A.B.max)
B.c <- runif(1, -A.B.max, A.B.max)
b.max <- 2
b.c <- runif(1, 0, b.max)

ssp <- spectrum(Y, plot = FALSE)
a.c <- 2 * pi * ssp$freq[[which.max(ssp$spec)]]

f.min <- function(A, B, a, b) {
  return(f(xi, A.arg = A, B.arg = B, a.arg = a, b.arg = b))
}
phi.nls <- nls(Y ~ f.min(A, B, a, b),
               start = list(A = A.c, B = B.c, a = a.c, b = b.c),
               control = nls.control(warnOnly = TRUE))
c <- coef(phi.nls)

print(c)

plot(Y, type = "l")
lines(f(xi, A.arg = c[["A"]], B.arg = c[["B"]], a.arg = c[["a"]], b.arg = c[["b"]]),
      type = "l", col = "red")
```
